{% extends 'base.html' %}{% block content %}
<div class="glass">
  <h2>Welcome, {{ current_user.username }}!</h2>
  <div class="stats" style="margin:8px 0 16px">
    <div class="stat">üî• Streak: <strong>{{ current_user.streak }}</strong></div>
    <div class="stat">‚≠ê XP: <strong>{{ current_user.xp }}</strong></div>
  </div>
  {% if challenge %}
    <h3>Today's Snack: {{ challenge.title }}</h3>
    <p style="white-space: pre-wrap">{{ challenge.prompt }}</p>
    <div class="glass" id="runner" data-challenge-lang="{{ challenge.language }}">
      <h3>Try your solution</h3>
      <div class="runner-toolbar">
        <label for="lang">Language</label>
        <select id="lang">
          <option value="auto">Auto (challenge language)</option>
          <option value="js">JavaScript</option>
          <option value="ts">TypeScript</option>
          <option value="py">Python</option>
          <option value="txt">Other (notes)</option>
        </select>
        <button class="btn-primary" id="runBtn" type="button">Run</button>
      </div>
      <div id="runner-note" class="runner-note"></div>
      <div class="runner-grid">
        <div class="runner-panel">
          <label for="code">Code</label>
          <textarea id="code" rows="12" placeholder="Choose a language to load a starter template."></textarea>
        </div>
        <div class="runner-panel">
          <label for="input">Input</label>
          <textarea id="input" rows="6" placeholder="Text passed to solve(input). Multi-line input supported."></textarea>
        </div>
      </div>
      <label for="output" class="runner-output-label">Output</label>
      <pre id="output" class="card" style="min-height:120px; margin-top:8px;"></pre>
    </div>
    {% if challenge.hints %}
      <button onclick="toggle('hint')" class="ghost">Show Hint</button>
      <div id="hint" style="display:none;margin-top:10px" class="card"><strong>Hint:</strong><br>{{ challenge.hints }}</div>
    {% endif %}
    {% if challenge.solution %}
      <button onclick="toggle('solution')" class="ghost" style="margin-left:6px">Reveal Solution</button>
      <div id="solution" style="display:none;margin-top:10px" class="card"><strong>Solution:</strong><pre class="code-block">{{ challenge.solution }}</pre></div>
    {% endif %}
    <form method="post" action="{{ url_for('submit_challenge', challenge_id=challenge.id) }}" style="margin-top:12px">
      <button type="submit" class="btn-primary">Mark as Solved (+10 XP)</button>
    </form>
  {% else %}
    <p>No more challenges for now. Check back soon!</p>
  {% endif %}
  {% if joke %}<div class="card joke" style="margin-top:14px">üí° {{ joke }}</div>{% endif %}
</div>
{% endblock %}
